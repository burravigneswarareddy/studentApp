<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Student Count by Country</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 60%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>Student Count by Country</h1>
  <p id="status">Loading data...</p>

  <table id="studentTable" style="display:none;">
    <thead>
      <tr>
        <th>Country</th>
        <th>Student Count</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // âœ… CSV file hosted inside the SAME Static Web App
    const csvUrl = "./student-dataset.csv";

    function parseCSV(csvText) {
      const lines = csvText.trim().split(/\r?\n/);
      const headers = lines[0].split(",").map(h => h.trim());
      const rows = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(",").map(v => v.trim());
        const row = {};
        headers.forEach((h, idx) => row[h] = values[idx] ?? "");
        rows.push(row);
      }
      return rows;
    }

    async function fetchStudentData() {
      const statusEl = document.getElementById("status");
      const table = document.getElementById("studentTable");
      const tbody = document.querySelector("#studentTable tbody");

      try {
        const response = await fetch(csvUrl, { cache: "no-store" });
        if (!response.ok) {
          throw new Error("HTTP " + response.status);
        }

        const csvText = await response.text();
        const rows = parseCSV(csvText);

        const counts = {};
        rows.forEach(r => {
          const country = r["Country"] || "Unknown";
          counts[country] = (counts[country] || 0) + 1;
        });

        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);

        tbody.innerHTML = "";
        sorted.forEach(([country, count]) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${country}</td><td>${count}</td>`;
          tbody.appendChild(tr);
        });

        statusEl.innerText = `Loaded ${rows.length} students`;
        table.style.display = "table";

      } catch (err) {
        console.error(err);
        statusEl.innerText = "Error loading data: " + err.message;
      }
    }

    fetchStudentData();
  </script>
</body>
</html>
